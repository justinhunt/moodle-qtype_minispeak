define ("qtype_minispeak/dictation",["jquery","core/log","qtype_minispeak/definitions","qtype_minispeak/pollyhelper"],function(a,b,c,d){"use strict";b.debug("minispeak dictation: initialising");return{answers:{},playing:!1,clone:function clone(){return a.extend(!0,{},this)},init:function init(a,b,c,d){this.prepare_audio(b,d);this.register_events(a,b,c)},prepare_html:function prepare_html(){},prepare_audio:function prepare_audio(b){a.each(b.sentences,function(c,e){d.fetch_polly_url(e.prompt,b.voiceoption,b.usevoice).then(function(d){a("#"+b.uniqueid+"_container .dictationplayer_"+c+" .dictationtrigger").attr("data-src",d)})})},register_events:function register_events(b,c,d){var f=this,g=a("#"+c.uniqueid+"_player"),h=null,i=a("#"+c.uniqueid+"_container .dictate-feedback").length;function e(){var e={},g=a("#"+c.uniqueid+"_container .dictate-feedback.fa-check").length,j=Math.round(100*g/i,2);if(j===h){return}h=j;e.index=b;e.hasgrade=!0;e.grade=j;e.totalitems=i;e.correctitems=g;e.answers=f.answers;d.do_next(e)}a("#"+c.uniqueid+"_container .poodlldictationinput input").on("input",function(){var b=a(this).data("index"),g=c.sentences[b].sentence.trim().toLowerCase(),h=a(this).val().trim().toLowerCase();a("#"+c.uniqueid+"_container .dictationplayer_"+b+"_chars").html(h.length);if(c.ignorepunctuation){g=d.cleanText(g);h=d.cleanText(h)}f.answers[b]={answer:h,correct:g==h};if(g==h){a("#"+c.uniqueid+"_container .dictate-feedback[data-index='"+b+"']").removeClass("fa-times").addClass("fa-check").css("color","green").show()}else{a("#"+c.uniqueid+"_container .dictate-feedback[data-index='"+b+"']").removeClass("fa-check").addClass("fa-times").css("color","red").show()}e()});a("#"+c.uniqueid+"_container .dictationtrigger").on("click",function(){if(!f.playing){var b=this;f.playing=!0;g.attr("src",a(this).attr("data-src"));g[0].play();g[0].onended=function(){a(b).find(".fa").removeClass("fa-spin fa-spinner").addClass("fa-play");f.playing=!1};a(b).find(".fa").removeClass("fa-play").addClass("fa-spin fa-spinner")}});a("#"+c.uniqueid+"_container .minispeak_nextbutton").on("click",e)}}});
//# sourceMappingURL=dictation.min.js.map
