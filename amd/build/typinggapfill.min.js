function _toArray(a){return _arrayWithHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(!a)return;if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray(a,b)}function _iterableToArray(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}define ("qtype_minispeak/typinggapfill",["jquery","core/log","core/ajax","qtype_minispeak/definitions","qtype_minispeak/animatecss","qtype_minispeak/progresstimer"],function(a,b,c,d,e){"use strict";b.debug("minispeak typing gap fill: initialising");return{answers:{},clone:function clone(){return a.extend(!0,{},this)},init:function init(a,b,c){var d=this;d.itemdata=b;d.quizhelper=c;d.index=a;var f={useanimatecss:c.useanimatecss};e.init(f);d.register_events();d.getItems();d.appReady()},next_question:function next_question(a){var b=this,c={};c.index=b.index;c.hasgrade=!0;c.totalitems=b.items.length;c.correctitems=b.items.filter(function(a){return a.correct}).length;c.grade=Math.round(100*(c.correctitems/c.totalitems));c.answers=b.answers;b.quizhelper.do_next(c,a)},register_events:function register_events(){var b=this;a("#"+b.itemdata.uniqueid+"_container .minispeak_nextbutton").on("click",function(){b.next_question()});a("#"+b.itemdata.uniqueid+"_container .tgapfill_start_btn").on("click",function(){b.start()});a("#"+b.itemdata.uniqueid+"_container .tgapfill_skip_btn").on("click",function(){a(this).prop("disabled",!0);a("#"+b.itemdata.uniqueid+"_container .tgapfill_check_btn").prop("disabled",!0);b.stopTimer(b.items[b.game.pointer].timer);if(b.game.pointer<b.items.length-1){setTimeout(function(){a(".tgapfill_reply_"+b.game.pointer).hide();b.items[b.game.pointer].answered=!0;b.items[b.game.pointer].correct=!1;b.game.pointer++;b.nextPrompt()},2e3)}else{b.end()}});a("#"+b.itemdata.uniqueid+"_container .tgapfill_check_btn").on("click",function(){b.check_answer()});a("#"+b.itemdata.uniqueid+"_container").on("keydown",".single-character",function(a){if(13==a.which){b.check_answer()}})},game:{pointer:0},check_answer:function check_answer(){var b=this,c=b.items[b.game.pointer].parsedstring,d=a("#"+b.itemdata.uniqueid+"_container .tgapfill_reply_"+b.game.pointer+" input.single-character"),e=[];d.each(function(){var b=a(this).data("index"),c=a(this).val();e.push({index:b,value:c})});b.getComparison(c,e,function(a){b.gotComparison(a)})},getItems:function getItems(){var a=this,b=a.itemdata.sentences;a.items=b.map(function(a){return{target:a.sentence,prompt:a.prompt,parsedstring:a.parsedstring,definition:a.definition,timer:[],typed:"",answered:!1,correct:!1,audio:null}}).filter(function(a){return""!==a.target})},appReady:function appReady(){var b=this;a("#"+b.itemdata.uniqueid+"_container .tgapfill_not_loaded").hide();a("#"+b.itemdata.uniqueid+"_container .tgapfill_loaded").show();a("#"+b.itemdata.uniqueid+"_container .tgapfill_start_btn").prop("disabled",!1)},gotComparison:function gotComparison(b){var c=this,d=a("#"+c.itemdata.uniqueid+"_container .progress-container .progress-bar");if(b){a("#"+c.itemdata.uniqueid+"_container .tgapfill_reply_"+c.game.pointer+" .tgapfill_feedback[data-idx='"+c.game.pointer+"']").addClass("fa fa-check");c.items[c.game.pointer].answered=!0;c.items[c.game.pointer].correct=!0;c.items[c.game.pointer].typed=!1;a("#"+c.itemdata.uniqueid+"_container .tgapfill_reply_"+c.game.pointer+" input").addClass("ms_gapfill_char_correct")}else if(!c.itemdata.allowretry||d.hasClass("progress-bar-complete")){a("#"+c.itemdata.uniqueid+"_container .tgapfill_reply_"+c.game.pointer+" .tgapfill_feedback[data-idx='"+c.game.pointer+"']").addClass("fa fa-times");c.items[c.game.pointer].answered=!0;c.items[c.game.pointer].correct=!1;c.items[c.game.pointer].typed=!1}else{var f=a("#"+c.itemdata.uniqueid+"_container .tgapfill_reply_"+c.game.pointer);e.do_animate(f,"shakeX animate__faster").then(function(){a("#"+c.itemdata.uniqueid+"_container .tgapfill_ctrl-btn").prop("disabled",!1)});return}c.stopTimer(c.items[c.game.pointer].timer);if(c.game.pointer<c.items.length-1){setTimeout(function(){a(".tgapfill_reply_"+c.game.pointer).hide();c.game.pointer++;c.nextPrompt()},2e3)}else{c.end()}},getComparison:function getComparison(b,c,d){var e=this;a(".tgapfill_ctrl-btn").prop("disabled",!0);var f=!0;b.forEach(function(b,c){var d="";if("input"===b.type){if(!0===f){d=a("#"+e.itemdata.uniqueid+"_container .tgapfill_reply_"+e.game.pointer+" input.single-character[data-index=\""+c+"\"]").val();if(""==d){f=!1}else if(d!=b.character){f=!1}}}});e.answers[e.game.pointer]={answer:c,correct:f};d(f)},end:function end(){var b=this;a(".minispeak_nextbutton").prop("disabled",!0);setTimeout(function(){a(".minispeak_nextbutton").prop("disabled",!1);b.next_question(!0)},2e3)},start:function start(){var b=this;a("#"+b.itemdata.uniqueid+"_container .tgapfill_ctrl-btn").prop("disabled",!0);b.items.forEach(function(a){a.spoken="";a.answered=!1;a.correct=!1});b.game.pointer=0;a("#"+b.itemdata.uniqueid+"_container .question").show();a("#"+b.itemdata.uniqueid+"_container .tgapfill_start_btn").hide();a("#"+b.itemdata.uniqueid+"_container .tgapfill_mainmenu").hide();a("#"+b.itemdata.uniqueid+"_container .tgapfill_controls").show();b.nextPrompt()},nextPrompt:function nextPrompt(){var b=this;a(".tgapfill_ctrl-btn").prop("disabled",!1);var c,d=b.items.map(function(a,d){c="gray";if(b.items[d].answered&&b.items[d].correct){c="green"}else if(b.items[d].answered&&!b.items[d].correct){c="red"}return"<i style='color:"+c+"' class='fa fa-circle'></i>"}).join(" ");a("#"+b.itemdata.uniqueid+"_container .tgapfill_title").html(d);b.nextReply()},nextReply:function nextReply(){var c=this,d="<div class='tgapfill_reply tgapfill_reply_"+c.game.pointer+" text-center' style='display:none;'>";d+="<div class='form-container'>";c.items[c.game.pointer].parsedstring.forEach(function(a,b){if("input"===a.type){d+="<input class='single-character' autocomplete='off' type='text' name='filltext"+b+"' maxlength='1' data-index='"+b+"'>"}else if("mtext"===a.type){d+="<input class='single-character-mtext' type='text' name='readonly"+b+"' maxlength='1' value='"+a.character+"' readonly>"}else{d+=a.character}});d+=" <i data-idx='"+c.game.pointer+"' class='tgapfill_feedback'></i></div>";d+="<div class='definition-container'>";d+="<div class='definition'>"+c.items[c.game.pointer].definition+"</div>";d+="</div>";d+="</div>";a("#"+c.itemdata.uniqueid+"_container .question").append(d);var f=a(".tgapfill_reply_"+c.game.pointer);e.do_animate(f,"zoomIn animate__faster","in").then(function(){});a("#"+c.itemdata.uniqueid+"_container .tgapfill_ctrl-btn").prop("disabled",!1);var g=_toConsumableArray(document.querySelectorAll("#"+c.itemdata.uniqueid+"_container .tgapfill_reply_"+c.game.pointer+" input.single-character"));c.formReady(g);a("#"+c.itemdata.uniqueid+"_container .tgapfill_reply_"+c.game.pointer+" input.single-character:first").focus();if(0<c.itemdata.timelimit){a("#"+c.itemdata.uniqueid+"_container .progress-container").show();a("#"+c.itemdata.uniqueid+"_container .progress-container i").show();var h=a("#"+c.itemdata.uniqueid+"_container .progress-container #progresstimer").progressTimer({height:"5px",timeLimit:c.itemdata.timelimit,onFinish:function onFinish(){b.debug("timer finished");var d=a("#"+c.itemdata.uniqueid+"_container .tgapfill_check_btn");b.debug(d);a("#"+c.itemdata.uniqueid+"_container .tgapfill_check_btn").trigger("click")}});h.each(function(){c.items[c.game.pointer].timer.push(a(this).attr("timer"))})}},stopTimer:function stopTimer(a){if(a.length){a.forEach(function(a){clearInterval(a)})}},formReady:function formReady(a){a.forEach(function(b,c){b.addEventListener("keydown",function(b){if(8===b.keyCode&&""===b.target.value){a[Math.max(0,c-1)].focus()}});b.addEventListener("input",function(b){var d=_toArray(b.target.value),e=d[0],f=d.slice(1);b.target.value=null!==e&&void 0!==e?e:"";var g=c===a.length-1;if(e!==void 0&&!g){a[c+1].focus();a[c+1].value=f.join("");a[c+1].dispatchEvent(new Event("input"))}})})}}});
//# sourceMappingURL=typinggapfill.min.js.map
