function _toArray(a){return _arrayWithHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(!a)return;if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray(a,b)}function _iterableToArray(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}define ("qtype_minispeak/listeninggapfill",["jquery","core/log","core/ajax","qtype_minispeak/definitions","qtype_minispeak/pollyhelper","qtype_minispeak/animatecss","qtype_minispeak/progresstimer"],function(a,b,c,d,e,f){"use strict";b.debug("minispeak listening gap fill: initialising");return{answers:{},clone:function clone(){return a.extend(!0,{},this)},usevoice:"Amy",init:function init(a,b,c){var d=this;d.itemdata=b;d.quizhelper=c;d.index=a;var e={useanimatecss:c.useanimatecss};f.init(e);d.register_events();d.setvoice();d.getItems();d.appReady()},next_question:function next_question(a){var b=this,c={};c.index=b.index;c.hasgrade=!0;c.totalitems=b.items.length;c.correctitems=b.items.filter(function(a){return a.correct}).length;c.grade=Math.round(100*(c.correctitems/c.totalitems));c.answers=b.answers;b.quizhelper.do_next(c,a)},register_events:function register_events(){var b=this;a("#"+b.itemdata.uniqueid+"_container .minispeak_nextbutton").on("click",function(){b.next_question()});a("#"+b.itemdata.uniqueid+"_container .lgapfill_start_btn").on("click",function(){b.start()});var c=a("#"+b.itemdata.uniqueid+"_container .lgapfill_listen_btn");c.on("click",function(){var d=b.items[b.game.pointer].audio;if(!d.paused){d.pause();d.currentTime=0;a(c).children(".fa").removeClass("fa-stop");a(c).children(".fa").addClass("fa-volume-up");return}d.addEventListener("ended",function(){a(c).children(".fa").removeClass("fa-stop");a(c).children(".fa").addClass("fa-volume-up")});d.addEventListener("play",function(){a(c).children(".fa").removeClass("fa-volume-up");a(c).children(".fa").addClass("fa-stop")});d.load();d.play()});a("#"+b.itemdata.uniqueid+"_container").on("keydown",".single-character",function(a){if(32==a.which){a.preventDefault();c.trigger("click")}});a("#"+b.itemdata.uniqueid+"_container .lgapfill_skip_btn").on("click",function(){a("#"+b.itemdata.uniqueid+"_container .lgapfill_ctrl-btn").prop("disabled",!0);a("#"+b.itemdata.uniqueid+"_container .lgapfill_speech.lgapfill_teacher_left").text(b.items[b.game.pointer].prompt+"");a("#"+b.itemdata.uniqueid+"_container .lgapfill_targetWord").each(function(){var c=a(this).data("realidx"),d=b.items[b.game.pointer].lgapfill_targetWords[c];a(this).val(d)});b.stopTimer(b.items[b.game.pointer].timer);if(b.game.pointer<b.items.length-1){setTimeout(function(){a(".lgapfill_reply_"+b.game.pointer).hide();b.items[b.game.pointer].answered=!0;b.items[b.game.pointer].correct=!1;b.game.pointer++;b.nextPrompt()},2e3)}else{b.end()}});a("#"+b.itemdata.uniqueid+"_container .lgapfill_check_btn").on("click",function(){b.check_answer()});a("#"+b.itemdata.uniqueid+"_container").on("keydown",".single-character",function(a){if(13==a.which){b.check_answer()}});a("#"+b.itemdata.uniqueid+"_container").on("keyup",".lgapfill_targetWord",function(c){var d=c.srcElement||c.target,e=parseInt(d.attributes.maxlength.value,10),f=d.value.length,g=c.which;if(f>=e){var h=a(this).data("idx")+1,i=a("#"+b.itemdata.uniqueid+"_container input.lgapfill_targetWord[data-idx=\""+h+"\"");if(1===i.length){i.focus()}}else if((8==g||46==g)&&0===f){var j=a(this).data("idx")-1,k=a("#"+b.itemdata.uniqueid+"_container input.lgapfill_targetWord[data-idx=\""+j+"\"");if(1===k.length){k.focus()}}})},game:{pointer:0},check_answer:function check_answer(){var b=this,c=b.items[b.game.pointer].parsedstring,d=a("#"+b.itemdata.uniqueid+"_container .lgapfill_reply_"+b.game.pointer+" input.single-character"),e=[];d.each(function(){var b=a(this).data("index"),c=a(this).val();e.push({index:b,value:c})});b.getComparison(c,e,function(a){b.gotComparison(a)})},setvoice:function setvoice(){var a=this;a.usevoice=a.itemdata.usevoice;a.voiceoption=a.itemdata.voiceoption},getItems:function getItems(){var b=this,c=b.itemdata.sentences;b.items=c.map(function(a){return{target:a.sentence,prompt:a.prompt,parsedstring:a.parsedstring,definition:a.definition,typed:"",timer:[],answered:!1,correct:!1,audio:null}}).filter(function(a){return""!==a.target});a.each(b.items,function(a,c){e.fetch_polly_url(c.prompt,b.voiceoption,b.usevoice).then(function(a){c.audio=new Audio;c.audio.src=a;if(0==b.items.filter(function(a){return null==a.audio}).length){b.appReady()}})})},appReady:function appReady(){var b=this;a("#"+b.itemdata.uniqueid+"_container .lgapfill_not_loaded").hide();a("#"+b.itemdata.uniqueid+"_container .lgapfill_loaded").show();a("#"+b.itemdata.uniqueid+"_container .lgapfill_start_btn").prop("disabled",!1)},gotComparison:function gotComparison(c){var d=this;b.debug("gotComparison",c);var e=a("#"+d.itemdata.uniqueid+"_container .progress-container .progress-bar");if(c){a("#"+d.itemdata.uniqueid+"_container .lgapfill_reply_"+d.game.pointer+" .lgapfill_feedback[data-idx='"+d.game.pointer+"']").addClass("fa fa-check");d.items[d.game.pointer].answered=!0;d.items[d.game.pointer].correct=!0;d.items[d.game.pointer].typed=!1;b.debug("correct!!");a("#"+d.itemdata.uniqueid+"_container .lgapfill_reply_"+d.game.pointer+" input").addClass("ms_gapfill_char_correct")}else if(!d.itemdata.allowretry||e.hasClass("progress-bar-complete")){a("#"+d.itemdata.uniqueid+"_container .lgapfill_reply_"+d.game.pointer+" .lgapfill_feedback[data-idx='"+d.game.pointer+"']").addClass("fa fa-times");d.items[d.game.pointer].answered=!0;d.items[d.game.pointer].correct=!1;d.items[d.game.pointer].typed=!1}else{var g=a("#"+d.itemdata.uniqueid+"_container .lgapfill_reply_"+d.game.pointer);f.do_animate(g,"shakeX animate__faster").then(function(){a("#"+d.itemdata.uniqueid+"_container .lgapfill_ctrl-btn").prop("disabled",!1)});return}d.stopTimer(d.items[d.game.pointer].timer);if(d.game.pointer<d.items.length-1){setTimeout(function(){a(".lgapfill_reply_"+d.game.pointer).hide();d.game.pointer++;d.nextPrompt()},2e3)}else{d.end()}},getWords:function getWords(a){var b=this;if("false"==!1){a=a.toLowerCase()}for(var c=a.split(b.quizhelper.spliton_regexp).filter(function(a){return""!==a}),d=[],e=0;e<c.length;e++){if(!c[e].match(b.quizhelper.spliton_regexp)){d.push(c[e])}}return d},getComparison:function getComparison(b,c,d){var e=this;a(".lgapfill_ctrl-btn").prop("disabled",!0);var f=!0;b.forEach(function(b,c){var d="";if("input"===b.type){if(!0===f){d=a("#"+e.itemdata.uniqueid+"_container .lgapfill_reply_"+e.game.pointer+" input.single-character[data-index=\""+c+"\"]").val();if(""==d){f=!1}else if(d!=b.character){f=!1}}}});e.answers[e.game.pointer]={answer:c,correct:!!f};d(f)},end:function end(){var b=this;a(".minispeak_nextbutton").prop("disabled",!0);setTimeout(function(){a(".minispeak_nextbutton").prop("disabled",!1);b.next_question(!0)},2e3)},start:function start(){var b=this;a("#"+b.itemdata.uniqueid+"_container .lgapfill_ctrl-btn").prop("disabled",!0);b.items.forEach(function(a){a.spoken="";a.answered=!1;a.correct=!1});b.answers={};b.game.pointer=0;a("#"+b.itemdata.uniqueid+"_container .lgapfill_listen_cont").show();a("#"+b.itemdata.uniqueid+"_container .question").show();a("#"+b.itemdata.uniqueid+"_container .lgapfill_game").show();a("#"+b.itemdata.uniqueid+"_container .lgapfill_start_btn").hide();a("#"+b.itemdata.uniqueid+"_container .lgapfill_mainmenu").hide();a("#"+b.itemdata.uniqueid+"_container .lgapfill_controls").show();b.nextPrompt()},nextPrompt:function nextPrompt(){var b=this;a(".lgapfill_ctrl-btn").prop("disabled",!1);var c,d=b.items.map(function(a,d){c="gray";if(b.items[d].answered&&b.items[d].correct){c="green"}else if(b.items[d].answered&&!b.items[d].correct){c="red"}return"<i style='color:"+c+"' class='fa fa-circle'></i>"}).join(" ");a("#"+b.itemdata.uniqueid+"_container .lgapfill_title").html(d);b.nextReply();a("#"+b.itemdata.uniqueid+"_container .lgapfill_listen_btn").trigger("click")},nextReply:function nextReply(){var b=this,c="<div class='lgapfill_reply lgapfill_reply_"+b.game.pointer+" text-center' style='display:none;'>";c+="<div class='form-container'>";b.items[b.game.pointer].parsedstring.forEach(function(a,b){if("input"===a.type){c+="<input class='single-character' type='text' autocomplete='off' name='filltext"+b+"' maxlength='1' data-index='"+b+"'>"}else if("mtext"===a.type){c+="<input class='single-character-mtext' autocomplete='off' type='text' name='readonly"+b+"' maxlength='1' value='"+a.character+"' readonly>"}else{c+=a.character}});c+=" <i data-idx='"+b.game.pointer+"' class='lgapfill_feedback'></i></div>";if(""!==b.items[b.game.pointer].definition){c+="<div class='definition-container'>";c+="<div class='definition'>"+b.items[b.game.pointer].definition+"</div>";c+="</div>"}c+="</div>";a("#"+b.itemdata.uniqueid+"_container .question").append(c);var d=a(".lgapfill_reply_"+b.game.pointer);f.do_animate(d,"zoomIn animate__faster","in").then(function(){});a("#"+b.itemdata.uniqueid+"_container .lgapfill_ctrl-btn").prop("disabled",!1);var e=_toConsumableArray(document.querySelectorAll("#"+b.itemdata.uniqueid+"_container .lgapfill_reply_"+b.game.pointer+" input.single-character"));b.formReady(e);a("#"+b.itemdata.uniqueid+"_container .lgapfill_reply_"+b.game.pointer+" input.single-character:first").focus();if(0<b.itemdata.timelimit){a("#"+b.itemdata.uniqueid+"_container .progress-container").show();a("#"+b.itemdata.uniqueid+"_container .progress-container i").show();var g=a("#"+b.itemdata.uniqueid+"_container .progress-container #progresstimer").progressTimer({height:"5px",timeLimit:b.itemdata.timelimit,onFinish:function onFinish(){a("#"+b.itemdata.uniqueid+"_container .lgapfill_check_btn").trigger("click")}});g.each(function(){b.items[b.game.pointer].timer.push(a(this).attr("timer"))})}},stopTimer:function stopTimer(a){if(a.length){a.forEach(function(a){clearInterval(a)})}},formReady:function formReady(a){a.forEach(function(b,c){b.addEventListener("keydown",function(b){if(8===b.keyCode&&""===b.target.value){a[Math.max(0,c-1)].focus()}});b.addEventListener("input",function(b){var d=_toArray(b.target.value),e=d[0],f=d.slice(1);b.target.value=null!==e&&void 0!==e?e:"";var g=c===a.length-1;if(e!==void 0&&!g){a[c+1].focus();a[c+1].value=f.join("");a[c+1].dispatchEvent(new Event("input"))}})})}}});
//# sourceMappingURL=listeninggapfill.min.js.map
