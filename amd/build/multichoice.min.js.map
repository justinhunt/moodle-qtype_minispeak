{"version":3,"file":"multichoice.min.js","sources":["../src/multichoice.js"],"sourcesContent":["define(['jquery', 'core/log', 'qtype_minispeak/definitions', 'qtype_minispeak/pollyhelper','qtype_minispeak/animatecss'],\n    function($, log, def, polly, anim) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the quiz stage\n   */\n\n  log.debug('minispeak Multichoice: initialising');\n\n  return {\n\n    answers: {},\n\n    //for making multiple instances\n      clone: function () {\n          return $.extend(true, {}, this);\n     },\n\n    init: function(index, itemdata, quizhelper) {\n      if(itemdata.hasOwnProperty('audiocontent')) {\n          this.prepare_audio(itemdata);\n      }\n      this.itemdata = itemdata;\n      this.register_events(index, itemdata, quizhelper);\n\n        //anim\n        var animopts = {};\n        animopts.useanimatecss=quizhelper.useanimatecss;\n        anim.init(animopts);\n\n    },\n    next_question: function(percent) {\n      var self = this;\n      var stepdata = {};\n      stepdata.index = self.index;\n      stepdata.hasgrade = true;\n      stepdata.totalitems = 1;\n      stepdata.correctitems = percent>0?1:0;\n      stepdata.grade = percent;\n      stepdata.answers = self.answers;\n      self.quizhelper.do_next(stepdata, true);\n    },\n\n    register_events: function(index, itemdata, quizhelper) {\n\n      var self = this;\n      self.index = index;\n      self.quizhelper = quizhelper;\n      var chosenelement=null;\n      var theplayer = $(\"#\" + itemdata.uniqueid + \"_player\");\n      var nextbutton = $(\"#\" + itemdata.uniqueid + \"_container .minispeak_nextbutton\");\n\n      nextbutton.on('click', function(e) {\n        self.next_question(0);\n      });\n\n      //if we need to submit this question we dont allow skip\n        if(itemdata.confirmchoice===1 || itemdata.confirmchoice==='1') {\n            nextbutton.hide();\n        }\n\n\n      var finalChoice = function() {\n          //if disabled =>just return (already answered)\n          if($(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_response\").hasClass('minispeak_mc_disabled')){\n              return;\n          }\n\n          //get selected item index\n          var checked = $(chosenelement).data('index');\n\n          //disable the answers, cos its answered\n          $(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_response\").addClass('minispeak_mc_disabled');\n\n          //reveal answers\n          $(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_unanswered\").hide();\n          $(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_wrong\").show();\n\n          $(\"#\" + itemdata.uniqueid + \"_option\" + itemdata.correctanswer + \" .minispeak_mc_wrong\").hide();\n          $(\"#\" + itemdata.uniqueid + \"_option\" + itemdata.correctanswer + \" .minispeak_mc_right\").show();\n\n\n          //if answers were dots for audio content, show them\n          if(itemdata.hasOwnProperty('audiocontent')) {\n              for (var i = 0; i < itemdata.sentences.length; i++) {\n                  var theline = $(\"#\" + itemdata.uniqueid + \"_option\" + (i + 1));\n                  $(\"#\" + itemdata.uniqueid + \"_option\" + (i + 1) + ' .minispeak_sentence').text(itemdata.sentences[i].sentence);\n              }\n          }\n\n\n          //highlight selected answers\n          $(\"#\" + itemdata.uniqueid + \"_option\" + checked).addClass('minispeak_mc_selected');\n          var percent = checked == itemdata.correctanswer ? 100 : 0;\n          self.answers[0] = {\n            answer: checked,\n            correct: checked == itemdata.correctanswer,\n          };\n\n          $(\".minispeak_nextbutton\").prop(\"disabled\", true);\n          setTimeout(function() {\n              $(\".minispeak_nextbutton\").prop(\"disabled\", false);\n              self.next_question(percent);\n          }, 2000);\n\n      };//end of final choice\n\n      //on tapping of a response, we either action the choice or show a confirmation button\n      $(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_response\").on('click', function(e){\n          chosenelement = this;\n          if(itemdata.confirmchoice===0 || itemdata.confirmchoice==='0'){\n              finalChoice();\n          }else{\n\n              //highlight selected answer\n              //get selected item index\n              var checked = $(this).data('index');\n              $(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_response\").removeClass('minispeak_mc_selected');\n              $(\"#\" + itemdata.uniqueid + \"_option\" + checked).addClass('minispeak_mc_selected');\n\n              self.showConfirmButton(itemdata);\n          }\n      });\n\n        //on tapping of confirmation button, execute final choice\n        $(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_confirmchoice\").on('click', function(e){\n                finalChoice();\n        });\n\n      //play audio if we are doing this as an audio player thingy\n        //this will use the multichoice audio content template\n        $(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_audioplayer\").on('click', function(e) {\n            //if disabled =>just return (already answered)\n            if($(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_audioplayer\").hasClass('minispeak_mc_disabled')){\n                return;\n            }\n\n            //audio play requests\n            if (!self.playing) {\n                var el = this;\n                self.playing = true;\n                theplayer.attr('src', $(this).attr('data-src'));\n                theplayer[0].play();\n                theplayer[0].onended = function() {\n                    $(el).find(\".minispeak_mc_playstate\").removeClass(\"fa-spin fa-spinner\").addClass(\"fa-play\");\n                    self.playing = false;\n                };\n                $(el).find(\".minispeak_mc_playstate\").removeClass(\"fa-play\").addClass(\"fa-spin fa-spinner\");\n            }else{\n                theplayer[0].pause();\n                theplayer[0].currentTime=0;\n                $(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_playstate\").removeClass(\"fa-spin fa-spinner\").addClass(\"fa-play\");\n                self.playing = false;\n            }\n        });\n\n    },\n\n      showConfirmButton: function(itemdata) {\n          var confirmbutton =$(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_confirmchoice\");\n          anim.do_animate(confirmbutton,'zoomIn animate__faster','in');\n      },\n\n      prepare_audio: function(itemdata) {\n          // debugger;\n          $.each(itemdata.sentences, function(index, sentence) {\n              polly.fetch_polly_url(sentence.sentence, itemdata.voiceoption, itemdata.usevoice).then(function(audiourl) {\n                  $(\"#\" + itemdata.uniqueid + \"_audioplayer\" + (index+1)).attr(\"data-src\", audiourl);\n              });\n          });\n      }\n  };\n});"],"names":["define","$","log","def","polly","anim","debug","answers","clone","extend","this","init","index","itemdata","quizhelper","hasOwnProperty","prepare_audio","register_events","animopts","useanimatecss","next_question","percent","stepdata","hasgrade","totalitems","correctitems","grade","do_next","self","chosenelement","theplayer","uniqueid","nextbutton","on","e","confirmchoice","hide","finalChoice","hasClass","checked","data","addClass","show","correctanswer","i","sentences","length","text","sentence","answer","correct","prop","setTimeout","removeClass","showConfirmButton","playing","pause","currentTime","el","attr","play","onended","find","confirmbutton","do_animate","each","fetch_polly_url","voiceoption","usevoice","then","audiourl"],"mappings":"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"}