{"version":3,"sources":["../src/multichoice.js"],"names":["define","$","log","def","polly","anim","debug","answers","clone","extend","init","index","itemdata","quizhelper","hasOwnProperty","prepare_audio","register_events","animopts","useanimatecss","next_question","percent","self","stepdata","hasgrade","totalitems","correctitems","grade","do_next","chosenelement","theplayer","uniqueid","nextbutton","on","confirmchoice","hide","finalChoice","hasClass","checked","data","addClass","show","correctanswer","i","sentences","length","text","sentence","answer","correct","prop","setTimeout","removeClass","showConfirmButton","playing","el","attr","play","onended","find","pause","currentTime","confirmbutton","do_animate","each","fetch_polly_url","voiceoption","usevoice","then","audiourl"],"mappings":"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","sourcesContent":["define(['jquery', 'core/log', 'qtype_minispeak/definitions', 'qtype_minispeak/pollyhelper','qtype_minispeak/animatecss'],\n    function($, log, def, polly, anim) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the quiz stage\n   */\n\n  log.debug('minispeak Multichoice: initialising');\n\n  return {\n\n    answers: {},\n\n    //for making multiple instances\n      clone: function () {\n          return $.extend(true, {}, this);\n     },\n\n    init: function(index, itemdata, quizhelper) {\n      if(itemdata.hasOwnProperty('audiocontent')) {\n          this.prepare_audio(itemdata);\n      }\n      this.itemdata = itemdata;\n      this.register_events(index, itemdata, quizhelper);\n\n        //anim\n        var animopts = {};\n        animopts.useanimatecss=quizhelper.useanimatecss;\n        anim.init(animopts);\n\n    },\n    next_question: function(percent) {\n      var self = this;\n      var stepdata = {};\n      stepdata.index = self.index;\n      stepdata.hasgrade = true;\n      stepdata.totalitems = 1;\n      stepdata.correctitems = percent>0?1:0;\n      stepdata.grade = percent;\n      stepdata.answers = self.answers;\n      self.quizhelper.do_next(stepdata, true);\n    },\n\n    register_events: function(index, itemdata, quizhelper) {\n\n      var self = this;\n      self.index = index;\n      self.quizhelper = quizhelper;\n      var chosenelement=null;\n      var theplayer = $(\"#\" + itemdata.uniqueid + \"_player\");\n      var nextbutton = $(\"#\" + itemdata.uniqueid + \"_container .minispeak_nextbutton\");\n\n      nextbutton.on('click', function(e) {\n        self.next_question(0);\n      });\n\n      //if we need to submit this question we dont allow skip\n        if(itemdata.confirmchoice===1 || itemdata.confirmchoice==='1') {\n            nextbutton.hide();\n        }\n\n\n      var finalChoice = function() {\n          //if disabled =>just return (already answered)\n          if($(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_response\").hasClass('minispeak_mc_disabled')){\n              return;\n          }\n\n          //get selected item index\n          var checked = $(chosenelement).data('index');\n\n          //disable the answers, cos its answered\n          $(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_response\").addClass('minispeak_mc_disabled');\n\n          //reveal answers\n          $(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_unanswered\").hide();\n          $(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_wrong\").show();\n\n          $(\"#\" + itemdata.uniqueid + \"_option\" + itemdata.correctanswer + \" .minispeak_mc_wrong\").hide();\n          $(\"#\" + itemdata.uniqueid + \"_option\" + itemdata.correctanswer + \" .minispeak_mc_right\").show();\n\n\n          //if answers were dots for audio content, show them\n          if(itemdata.hasOwnProperty('audiocontent')) {\n              for (var i = 0; i < itemdata.sentences.length; i++) {\n                  var theline = $(\"#\" + itemdata.uniqueid + \"_option\" + (i + 1));\n                  $(\"#\" + itemdata.uniqueid + \"_option\" + (i + 1) + ' .minispeak_sentence').text(itemdata.sentences[i].sentence);\n              }\n          }\n\n\n          //highlight selected answers\n          $(\"#\" + itemdata.uniqueid + \"_option\" + checked).addClass('minispeak_mc_selected');\n          var percent = checked == itemdata.correctanswer ? 100 : 0;\n          self.answers[0] = {\n            answer: checked,\n            correct: checked == itemdata.correctanswer,\n          };\n\n          $(\".minispeak_nextbutton\").prop(\"disabled\", true);\n          setTimeout(function() {\n              $(\".minispeak_nextbutton\").prop(\"disabled\", false);\n              self.next_question(percent);\n          }, 2000);\n\n      };//end of final choice\n\n      //on tapping of a response, we either action the choice or show a confirmation button\n      $(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_response\").on('click', function(e){\n          chosenelement = this;\n          if(itemdata.confirmchoice===0 || itemdata.confirmchoice==='0'){\n              finalChoice();\n          }else{\n\n              //highlight selected answer\n              //get selected item index\n              var checked = $(this).data('index');\n              $(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_response\").removeClass('minispeak_mc_selected');\n              $(\"#\" + itemdata.uniqueid + \"_option\" + checked).addClass('minispeak_mc_selected');\n\n              self.showConfirmButton(itemdata);\n          }\n      });\n\n        //on tapping of confirmation button, execute final choice\n        $(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_confirmchoice\").on('click', function(e){\n                finalChoice();\n        });\n\n      //play audio if we are doing this as an audio player thingy\n        //this will use the multichoice audio content template\n        $(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_audioplayer\").on('click', function(e) {\n            //if disabled =>just return (already answered)\n            if($(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_audioplayer\").hasClass('minispeak_mc_disabled')){\n                return;\n            }\n\n            //audio play requests\n            if (!self.playing) {\n                var el = this;\n                self.playing = true;\n                theplayer.attr('src', $(this).attr('data-src'));\n                theplayer[0].play();\n                theplayer[0].onended = function() {\n                    $(el).find(\".minispeak_mc_playstate\").removeClass(\"fa-spin fa-spinner\").addClass(\"fa-play\");\n                    self.playing = false;\n                };\n                $(el).find(\".minispeak_mc_playstate\").removeClass(\"fa-play\").addClass(\"fa-spin fa-spinner\");\n            }else{\n                theplayer[0].pause();\n                theplayer[0].currentTime=0;\n                $(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_playstate\").removeClass(\"fa-spin fa-spinner\").addClass(\"fa-play\");\n                self.playing = false;\n            }\n        });\n\n    },\n\n      showConfirmButton: function(itemdata) {\n          var confirmbutton =$(\"#\" + itemdata.uniqueid + \"_container .minispeak_mc_confirmchoice\");\n          anim.do_animate(confirmbutton,'zoomIn animate__faster','in');\n      },\n\n      prepare_audio: function(itemdata) {\n          // debugger;\n          $.each(itemdata.sentences, function(index, sentence) {\n              polly.fetch_polly_url(sentence.sentence, itemdata.voiceoption, itemdata.usevoice).then(function(audiourl) {\n                  $(\"#\" + itemdata.uniqueid + \"_audioplayer\" + (index+1)).attr(\"data-src\", audiourl);\n              });\n          });\n      }\n  };\n});"],"file":"multichoice.min.js"}