{"version":3,"sources":["../src/speakinggapfill.js"],"names":["define","$","log","ajax","def","polly","cloudpoodll","ttrecorder","anim","debug","answers","clone","extend","init","index","itemdata","quizhelper","self","theCallback","message","type","words","items","game","pointer","maskedwords","Object","keys","forEach","key","push","getComparison","join","capturedspeech","phonetic","comparison","gotComparison","use_ttrecorder","opts","uniqueid","callback","stt_guided","is_stt_guided","wwwroot","id","animopts","useanimatecss","register_events","setvoice","getItems","next_question","showSummary","stepdata","hasgrade","totalitems","length","correctitems","filter","e","correct","reduce","item","grade","Math","round","do_next","on","start","audioplayerbtn","readsentence","theaudio","audio","paused","pause","currentTime","children","removeClass","addClass","addEventListener","load","play","prop","text","prompt","each","realidx","data","sgapfill_targetWord","sgapfill_targetWords","val","stopTimer","timer","setTimeout","hide","answered","nextPrompt","end","usevoice","voiceoption","text_items","sentences","map","target","sentence","parsedstring","displayprompt","definition","typed","fetch_polly_url","then","audiourl","Audio","src","appReady","show","feedback","allCorrect","matched","characterinput","character","obj","word","thereply","do_animate","timelimit_progressbar","allowretry","hasClass","passage","transcript","answer","comparePassageToTranscript","language","ajaxresult","payloadobject","JSON","parse","spoken","color","progress","idx","html","newprompt","nextReply","code","append","newreply","timelimit","progresbar","progressTimer","height","timeLimit","onFinish","trigger","attr","mobile_user","timers","clearInterval"],"mappings":"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","sourcesContent":["define(['jquery',\n    'core/log',\n    'core/ajax',\n    'qtype_minispeak/definitions',\n    'qtype_minispeak/pollyhelper',\n    'qtype_minispeak/cloudpoodllloader',\n    'qtype_minispeak/ttrecorder',\n    'qtype_minispeak/animatecss',\n    'qtype_minispeak/progresstimer'\n], function($, log, ajax, def, polly, cloudpoodll, ttrecorder, anim, progresstimer) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug('minispeak speaking gap fill: initialising');\n\n    return {\n\n        answers: {},\n\n        // For making multiple instances\n        clone: function() {\n            return $.extend(true, {}, this);\n        },\n\n        init: function(index, itemdata, quizhelper) {\n            var self = this;\n            var theCallback = function(message) {\n\n                switch (message.type) {\n                    case 'recording':\n                        break;\n\n                    case 'speech':\n                        log.debug(\"Speech at speaking gap fill -\");\n                        var words = self.items[self.game.pointer].words;\n                        var maskedwords = [];\n\n                        Object.keys(words).forEach(function(key) {\n                            maskedwords.push(words[key]);\n                        });\n\n                        self.getComparison(\n                            maskedwords.join(\" \"),\n                            message.capturedspeech,\n                            self.items[self.game.pointer].phonetic,\n                            function(comparison) {\n                                self.gotComparison(comparison, message);\n                            }\n                        );\n                        break;\n\n                }\n\n            };\n\n            if (quizhelper.use_ttrecorder()) {\n                var opts = {};\n                opts.uniqueid = itemdata.uniqueid;\n                opts.callback = theCallback;\n                opts.stt_guided = quizhelper.is_stt_guided();\n                opts.wwwroot = quizhelper.is_stt_guided();\n                ttrecorder.clone().init(opts);\n            } else {\n                // Init cloudpoodll push recorder\n                cloudpoodll.init('minispeak-recorder-listenrepeat-' + itemdata.id, theCallback);\n            }\n\n            self.itemdata = itemdata;\n            log.debug(\"itemdata\");\n            log.debug(itemdata);\n            self.quizhelper = quizhelper;\n            self.index = index;\n\n            // Anim\n            var animopts = {};\n            animopts.useanimatecss = quizhelper.useanimatecss;\n            anim.init(animopts);\n\n            self.register_events();\n            self.setvoice();\n            self.getItems();\n        },\n\n        next_question: function(showSummary) {\n            var self = this;\n            var stepdata = {};\n            stepdata.index = self.index;\n            stepdata.hasgrade = true;\n            stepdata.totalitems = self.items.length;\n            stepdata.correctitems = self.items.filter(function(e) {\n                return e.correct;\n            }).length;\n            stepdata.answers = self.items.reduce(function(answers, item, index) {\n                if (!answers[index]) {\n                    answers[index] = {};\n                }\n                answers[index].correct = Boolean(item.correct);\n                return answers;\n              }, self.answers);\n            stepdata.grade = Math.round((stepdata.correctitems / stepdata.totalitems) * 100);\n            self.quizhelper.do_next(stepdata, showSummary);\n        },\n\n        register_events: function() {\n\n            var self = this;\n            // On next button click\n            $(\"#\" + self.itemdata.uniqueid + \"_container .minispeak_nextbutton\").on('click', function(e) {\n                self.next_question();\n            });\n            // On start button click\n            $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_start_btn\").on(\"click\", function() {\n                self.start();\n            });\n\n            //AUDIO PLAYER Button events\n            var audioplayerbtn=$(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_listen_btn\");\n            // On listen button click\n            if(self.itemdata.readsentence) {\n                audioplayerbtn.on(\"click\", function () {\n                    var theaudio = self.items[self.game.pointer].audio;\n\n                    //if we are already playing stop playing\n                    if(!theaudio.paused){\n                        theaudio.pause();\n                        theaudio.currentTime=0;\n                        $(audioplayerbtn).children('.fa').removeClass('fa-stop');\n                        $(audioplayerbtn).children('.fa').addClass('fa-volume-up');\n                        return;\n                    }\n\n                    //change icon to indicate playing state\n                    theaudio.addEventListener('ended', function () {\n                        $(audioplayerbtn).children('.fa').removeClass('fa-stop');\n                        $(audioplayerbtn).children('.fa').addClass('fa-volume-up');\n                    });\n\n                    theaudio.addEventListener('play', function () {\n                        $(audioplayerbtn).children('.fa').removeClass('fa-volume-up');\n                        $(audioplayerbtn).children('.fa').addClass('fa-stop');\n                    });\n                    theaudio.load();\n                    theaudio.play();\n                });\n            }\n\n            // On skip button click\n            $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_skip_btn\").on(\"click\", function() {\n                // Disable the buttons\n                $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_ctrl-btn\").prop(\"disabled\", true);\n                // Reveal the prompt\n                $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_speech.sgapfill_teacher_left\").text(self.items[self.game.pointer].prompt + \"\");\n                // Reveal the answer\n                $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_targetWord\").each(function() {\n                    var realidx = $(this).data(\"realidx\");\n                    var sgapfill_targetWord = self.items[self.game.pointer].sgapfill_targetWords[realidx];\n                    $(this).val(sgapfill_targetWord);\n                });\n\n                self.stopTimer(self.items[self.game.pointer].timer);\n\n                if (self.game.pointer < self.items.length - 1) {\n                    // Move on after short time to next prompt\n                    setTimeout(function() {\n                        $(\".sgapfill_reply_\" + self.game.pointer).hide();\n                        self.items[self.game.pointer].answered = true;\n                        self.items[self.game.pointer].correct = false;\n                        self.game.pointer++;\n                        self.nextPrompt();\n                    }, 2000);\n                    // End question\n                } else {\n                    self.end();\n                }\n\n            });\n\n        },\n\n        game: {\n            pointer: 0\n        },\n\n        usevoice: '',\n\n        setvoice: function() {\n            var self = this;\n            self.usevoice = self.itemdata.usevoice;\n            self.voiceoption = self.itemdata.voiceoption;\n            return;\n        },\n\n        getItems: function() {\n            var self = this;\n            var text_items = self.itemdata.sentences;\n\n            self.items = text_items.map(function(target) {\n                return {\n                    target: target.sentence,\n                    prompt: target.prompt,\n                    parsedstring: target.parsedstring,\n                    displayprompt: target.displayprompt,\n                    definition: target.definition,\n                    phonetic: target.phonetic,\n                    words: target.words,\n                    typed: \"\",\n                    timer: [],\n                    answered: false,\n                    correct: false,\n                    audio: null\n                };\n            }).filter(function(e) {\n                return e.target !== \"\";\n            });\n\n            $.each(self.items, function(index, item) {\n                polly.fetch_polly_url(item.prompt, self.voiceoption, self.usevoice).then(function(audiourl) {\n                    item.audio = new Audio();\n                    item.audio.src = audiourl;\n                    if (self.items.filter(function(e) {\n                        return e.audio === null;\n                    }).length === 0) {\n                        self.appReady();\n                    }\n                });\n            });\n\n\n        },\n\n        appReady: function() {\n            var self = this;\n            $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_not_loaded\").hide();\n            $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_loaded\").show();\n            $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_start_btn\").prop(\"disabled\", false);\n        },\n\n        gotComparison: function(comparison, typed) {\n            log.debug(\"sgapfill comparison\");\n            var self = this;\n            var feedback = $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_reply_\" + self.game.pointer + \" .dictate_feedback[data-idx='\" + self.game.pointer + \"']\");\n\n            $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_targetWord\").removeClass(\"sgapfill_correct sgapfill_incorrect\");\n            $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_feedback\").removeClass(\"fa fa-check fa-times\");\n\n            var allCorrect = comparison.filter(function(e) {\n                return !e.matched;\n            }).length == 0;\n            log.debug('aallcorrect=' + allCorrect);\n\n            if (allCorrect && comparison && comparison.length > 0) {\n                self.items[self.game.pointer].parsedstring.forEach(function(data, index) {\n                    var characterinput = $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_reply_\" + self.game.pointer + ' input.single-character[data-index=\"' + index + '\"]');\n                    if (data.type === 'input') {\n                        characterinput.val(data.character);\n                    }\n                });\n\n                feedback.removeClass(\"fa fa-times\");\n                feedback.addClass(\"fa fa-check\");\n                //make the input boxes green and move forward\n                log.debug('applying correct class to input boxes');\n                $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_reply_\" + self.game.pointer + \" input\").addClass(\"ms_gapfill_char_correct\");\n\n                self.items[self.game.pointer].answered = true;\n                self.items[self.game.pointer].correct = true;\n                self.items[self.game.pointer].typed = typed;\n\n                $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_ctrl-btn\").prop(\"disabled\", true);\n\n                self.stopTimer(self.items[self.game.pointer].timer);\n\n                if (self.game.pointer < self.items.length - 1) {\n                    setTimeout(function() {\n                        $(\".sgapfill_reply_\" + self.game.pointer).hide();\n                        self.game.pointer++;\n                        self.nextPrompt();\n                    }, 2000);\n                } else {\n                    self.end();\n                }\n            } else {\n                feedback.removeClass(\"fa fa-check\");\n                feedback.addClass(\"fa fa-times\");\n                // Mark up the words as correct or not\n                comparison.forEach(function(obj) {\n                    var words = self.items[self.game.pointer].words;\n\n                    Object.keys(words).forEach(function(key) {\n                        if (words[key] == obj.word) {\n                            if (!obj.matched) {\n                                self.items[self.game.pointer].parsedstring.forEach(function(data, index) {\n                                    var characterinput = $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_reply_\" + self.game.pointer + ' input.single-character[data-index=\"' + index + '\"]');\n                                    if (data.index == key && data.type === 'input') {\n                                        characterinput.val('');\n                                    }\n                                });\n                            } else {\n                                self.items[self.game.pointer].parsedstring.forEach(function(data, index) {\n                                    var characterinput = $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_reply_\" + self.game.pointer + ' input.single-character[data-index=\"' + index + '\"]');\n                                    if (data.index == key && data.type === 'input') {\n                                        characterinput.val(data.character);\n                                    }\n                                });\n                            }\n                        }\n                    });\n                });\n                var thereply = $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_reply_\" + self.game.pointer);\n                anim.do_animate(thereply, 'shakeX animate__faster').then(\n                    function() {\n                        $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_ctrl-btn\").prop(\"disabled\", false);\n                    }\n                );\n            }\n            // Show all the correct words\n            $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_targetWord.sgapfill_correct\").each(function() {\n                var realidx = $(this).data(\"realidx\");\n                var sgapfill_targetWord = self.items[self.game.pointer].sgapfill_targetWords[realidx];\n                $(this).val(sgapfill_targetWord);\n            });\n\n            //if they cant retry OR the time limit is up, move on\n            var timelimit_progressbar = $(\"#\" + self.itemdata.uniqueid + \"_container .progress-container .progress-bar\");\n            if(!self.itemdata.allowretry || timelimit_progressbar.hasClass('progress-bar-complete')){\n                self.items[self.game.pointer].answered = true;\n                self.items[self.game.pointer].correct = false;\n                self.items[self.game.pointer].typed = typed;\n\n                $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_ctrl-btn\").prop(\"disabled\", true);\n\n                self.stopTimer(self.items[self.game.pointer].timer);\n\n                if (self.game.pointer < self.items.length - 1) {\n                    setTimeout(function() {\n                        $(\".sgapfill_reply_\" + self.game.pointer).hide();\n                        self.game.pointer++;\n                        self.nextPrompt();\n                    }, 2000);\n                } else {\n                    self.end();\n                }\n            }\n\n        },\n\n        getComparison: function(passage, transcript, phonetic, callback) {\n            var self = this;\n\n            if (!self.answers[self.game.pointer]) {\n                self.answers[self.game.pointer] = {};\n            }\n            self.answers[self.game.pointer].answer = transcript;\n\n            $(\".sgapfill_ctrl-btn\").prop(\"disabled\", true);\n            self.quizhelper.comparePassageToTranscript(passage, transcript, phonetic, self.itemdata.language).then(function(ajaxresult) {\n                var payloadobject = JSON.parse(ajaxresult);\n                if (payloadobject) {\n                    callback(payloadobject);\n                } else {\n                    callback(false);\n                }\n            });\n        },\n\n        end: function() {\n            var self = this;\n            $(\".minispeak_nextbutton\").prop(\"disabled\", true);\n            setTimeout(function() {\n\n                $(\".minispeak_nextbutton\").prop(\"disabled\", false);\n                self.next_question(true);\n\n            }, 2000);\n\n        },\n\n        start: function() {\n            var self = this;\n\n            $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_ctrl-btn\").prop(\"disabled\", true);\n            $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_speakbtncontainer\").show();\n\n            self.items.forEach(function(item) {\n                item.spoken = \"\";\n                item.answered = false;\n                item.correct = false;\n            });\n            self.answers = {};\n\n            self.game.pointer = 0;\n\n            $(\"#\" + self.itemdata.uniqueid + \"_container .question\").show();\n            if(self.itemdata.readsentence) {\n                $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_listen_cont\").show();\n            }\n            $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_start_btn\").hide();\n            $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_mainmenu\").hide();\n            $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_controls\").show();\n\n            self.nextPrompt();\n        },\n\n        nextPrompt: function() {\n            var self = this;\n\n            $(\".sgapfill_ctrl-btn\").prop(\"disabled\", false);\n\n            var color;\n\n            var progress = self.items.map(function(item, idx) {\n                color = \"gray\";\n                if (self.items[idx].answered && self.items[idx].correct) {\n                    color = \"green\";\n                } else if (self.items[idx].answered && !self.items[idx].correct) {\n                    color = \"red\";\n                }\n                return \"<i style='color:\" + color + \"' class='fa fa-circle'></i>\";\n            }).join(\" \");\n\n            $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_title\").html(progress);\n            var newprompt = $(\".sgapfill_prompt_\" + self.game.pointer);\n            anim.do_animate(newprompt, 'zoomIn animate__faster', 'in').then(\n                function() {\n                }\n            );\n            self.nextReply();\n\n        },\n\n        nextReply: function() {\n            var self = this;\n\n            var code = \"<div class='sgapfill_reply sgapfill_reply_\" + self.game.pointer + \" text-center' style='display:none;'>\";\n\n            code += \"<div class='form-container'>\";\n            self.items[self.game.pointer].parsedstring.forEach(function(data, index) {\n                if (data.type === 'input') {\n                    code += \"<input class='single-character' autocomplete='off' type='text' name='filltext\" + index + \"' maxlength='1' data-index='\" + index + \"' readonly>\";\n                } else if (data.type === 'mtext') {\n                    code += \"<input class='single-character-mtext' type='text' name='readonly\" + index + \"' maxlength='1' value='\" + data.character + \"' readonly>\";\n                } else {\n                    code += data.character;\n                }\n            });\n            //correct or not\n            code += \" <i data-idx='\" + self.game.pointer + \"' class='dictate_feedback'></i></div>\";\n\n            //definition\n            code += \"<div class='definition-container'>\";\n            code += \"<div class='definition'>\" + self.items[self.game.pointer].definition + \"</div>\";\n            code += \"</div>\";\n\n            $(\"#\" + self.itemdata.uniqueid + \"_container .question\").append(code);\n            var newreply = $(\".sgapfill_reply_\" + self.game.pointer);\n            anim.do_animate(newreply, 'zoomIn animate__faster', 'in').then(\n                function() {\n                }\n            );\n            $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_ctrl-btn\").prop(\"disabled\", false);\n\n            if (self.itemdata.timelimit > 0) {\n                $(\"#\" + self.itemdata.uniqueid + \"_container .progress-container\").show();\n                $(\"#\" + self.itemdata.uniqueid + \"_container .progress-container i\").show();\n                var progresbar = $(\"#\" + self.itemdata.uniqueid + \"_container .progress-container #progresstimer\").progressTimer({\n                    height: '5px',\n                    timeLimit: self.itemdata.timelimit,\n                    onFinish: function() {\n                        $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_skip_btn\").trigger('click');\n                    }\n                });\n\n                progresbar.each(function() {\n                    self.items[self.game.pointer].timer.push($(this).attr('timer'));\n                });\n            }\n\n            if (!self.quizhelper.mobile_user()) {\n                setTimeout(function() {\n                    $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_listen_btn\").trigger('click');\n                }, 1000);\n            }\n        },\n\n        stopTimer: function(timers) {\n            if (timers.length) {\n                timers.forEach(function(timer) {\n                    clearInterval(timer);\n                });\n            }\n        },\n    };\n});"],"file":"speakinggapfill.min.js"}