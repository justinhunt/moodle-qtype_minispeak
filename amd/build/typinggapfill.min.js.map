{"version":3,"sources":["../src/typinggapfill.js"],"names":["define","$","log","ajax","def","anim","debug","answers","clone","extend","init","index","itemdata","quizhelper","self","animopts","useanimatecss","register_events","getItems","appReady","next_question","showSummary","stepdata","hasgrade","totalitems","items","length","correctitems","filter","e","correct","grade","Math","round","do_next","uniqueid","on","start","prop","stopTimer","game","pointer","timer","setTimeout","hide","answered","nextPrompt","end","check_answer","which","passage","parsedstring","characterunputs","transcript","each","data","value","val","push","getComparison","comparison","gotComparison","text_items","sentences","map","target","sentence","prompt","definition","typed","audio","show","timelimit_progressbar","addClass","allowretry","hasClass","thereply","do_animate","then","callback","correctanswer","forEach","char","type","character","answer","item","spoken","color","progress","idx","join","html","nextReply","code","append","newreply","inputElements","document","querySelectorAll","formReady","focus","timelimit","progresbar","progressTimer","height","timeLimit","onFinish","btn","trigger","attr","timers","clearInterval","ele","addEventListener","keyCode","max","first","rest","lastInputBox","dispatchEvent","Event"],"mappings":"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","sourcesContent":["define(['jquery',\n    'core/log',\n    'core/ajax',\n    'qtype_minispeak/definitions',\n    'qtype_minispeak/animatecss',\n    'qtype_minispeak/progresstimer',\n], function($, log, ajax, def, anim, progresstimer) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug('minispeak typing gap fill: initialising');\n\n    return {\n\n        answers: {},\n\n        // For making multiple instances\n        clone: function() {\n            return $.extend(true, {}, this);\n        },\n\n        init: function(index, itemdata, quizhelper) {\n            var self = this;\n            self.itemdata = itemdata;\n            self.quizhelper = quizhelper;\n            self.index = index;\n\n            var animopts = {};\n            animopts.useanimatecss = quizhelper.useanimatecss;\n            anim.init(animopts);\n\n            self.register_events();\n            self.getItems();\n            self.appReady();\n        },\n\n        next_question: function(showSummary) {\n            var self = this;\n            var stepdata = {};\n            stepdata.index = self.index;\n            stepdata.hasgrade = true;\n            stepdata.totalitems = self.items.length;\n            stepdata.correctitems = self.items.filter(function(e) {\n                return e.correct;\n            }).length;\n            stepdata.grade = Math.round((stepdata.correctitems / stepdata.totalitems) * 100);\n            stepdata.answers = self.answers;\n            self.quizhelper.do_next(stepdata, showSummary);\n        },\n\n        register_events: function() {\n\n            var self = this;\n\n            // Next page button.\n            $(\"#\" + self.itemdata.uniqueid + \"_container .minispeak_nextbutton\").on('click', function(e) {\n                self.next_question();\n            });\n\n            // Start button.\n            $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_start_btn\").on(\"click\", function() {\n                self.start();\n            });\n\n            // Skip.\n            $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_skip_btn\").on(\"click\", function() {\n                $(this).prop(\"disabled\", true);\n                $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_check_btn\").prop(\"disabled\", true);\n                self.stopTimer(self.items[self.game.pointer].timer);\n                // Move on after short time, to next prompt, or next question.\n                if (self.game.pointer < self.items.length - 1) {\n                    setTimeout(function() {\n                        $(\".tgapfill_reply_\" + self.game.pointer).hide();\n                        self.items[self.game.pointer].answered = true;\n                        self.items[self.game.pointer].correct = false;\n                        self.game.pointer++;\n                        self.nextPrompt();\n                    }, 2000);\n                } else {\n                    self.end();\n                }\n            });\n\n            // Check.\n            $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_check_btn\").on(\"click\", function() {\n                self.check_answer();\n            });\n\n            // Listen for enter key on input boxes\n            $(\"#\" + self.itemdata.uniqueid + \"_container\").on(\"keydown\", \".single-character\", function(e) {\n                if (e.which == 13) {\n                    self.check_answer();\n                }\n            });\n        },\n\n        game: {\n            pointer: 0\n        },\n\n        check_answer: function() {\n            var self = this;\n            var passage = self.items[self.game.pointer].parsedstring;\n            var characterunputs = $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_reply_\" + self.game.pointer + ' input.single-character');\n            var transcript = [];\n\n            characterunputs.each(function() {\n                var index = $(this).data('index');\n                var value = $(this).val();\n                transcript.push({\n                    index: index,\n                    value: value\n                });\n            });\n\n            self.getComparison(passage, transcript, function(comparison) {\n                self.gotComparison(comparison);\n            });\n        },\n\n        getItems: function() {\n            var self = this;\n            var text_items = self.itemdata.sentences;\n\n            self.items = text_items.map(function(target) {\n                return {\n                    target: target.sentence,\n                    prompt: target.prompt,\n                    parsedstring: target.parsedstring,\n                    definition: target.definition,\n                    timer: [],\n                    typed: \"\",\n                    answered: false,\n                    correct: false,\n                    audio: null\n                };\n            }).filter(function(e) {\n                return e.target !== \"\";\n            });\n        },\n\n        appReady: function() {\n            var self = this;\n            $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_not_loaded\").hide();\n            $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_loaded\").show();\n            $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_start_btn\").prop(\"disabled\", false);\n        },\n\n        gotComparison: function(comparison) {\n            var self = this;\n            var timelimit_progressbar = $(\"#\" + self.itemdata.uniqueid + \"_container .progress-container .progress-bar\");\n            if (comparison) {\n                $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_reply_\" + self.game.pointer + \" .tgapfill_feedback[data-idx='\" + self.game.pointer + \"']\").addClass(\"fa fa-check\");\n                self.items[self.game.pointer].answered = true;\n                self.items[self.game.pointer].correct = true;\n                self.items[self.game.pointer].typed = false;\n                //make the input boxes green and move forward\n                $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_reply_\" + self.game.pointer + \" input\").addClass(\"ms_gapfill_char_correct\");\n\n            //if they cant retry OR the time limit is up, move on\n            } else if(!self.itemdata.allowretry || timelimit_progressbar.hasClass('progress-bar-complete')) {\n                $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_reply_\" + self.game.pointer + \" .tgapfill_feedback[data-idx='\" + self.game.pointer + \"']\").addClass(\"fa fa-times\");\n                self.items[self.game.pointer].answered = true;\n                self.items[self.game.pointer].correct = false;\n                self.items[self.game.pointer].typed = false;\n            } else {\n                //it was wrong but they can retry\n                var thereply = $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_reply_\" + self.game.pointer);\n                anim.do_animate(thereply, 'shakeX animate__faster').then(\n                    function() {\n                        $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_ctrl-btn\").prop(\"disabled\", false);\n                    }\n                );\n                return;\n            }\n\n            self.stopTimer(self.items[self.game.pointer].timer);\n\n            if (self.game.pointer < self.items.length - 1) {\n                setTimeout(function() {\n                    $(\".tgapfill_reply_\" + self.game.pointer).hide();\n                    self.game.pointer++;\n                    self.nextPrompt();\n                }, 2000);\n            } else {\n                self.end();\n            }\n        },\n\n        getComparison: function(passage, transcript, callback) {\n            var self = this;\n\n            $(\".tgapfill_ctrl-btn\").prop(\"disabled\", true);\n\n            var correctanswer = true;\n\n            passage.forEach(function(data, index) {\n                var char = '';\n\n                if (data.type === 'input') {\n                    if (correctanswer === true) {\n                        char = $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_reply_\" + self.game.pointer + ' input.single-character[data-index=\"' + index + '\"]').val();\n                        if (char == '') {\n                            correctanswer = false;\n                        } else if (char != data.character) {\n                            correctanswer = false;\n                        }\n                    }\n                }\n            });\n\n            self.answers[self.game.pointer] = {\n                answer: transcript,\n                correct: correctanswer,\n            }\n\n            callback(correctanswer);\n        },\n\n        end: function() {\n            var self = this;\n            $(\".minispeak_nextbutton\").prop(\"disabled\", true);\n            setTimeout(function() {\n                $(\".minispeak_nextbutton\").prop(\"disabled\", false);\n                self.next_question(true);\n            }, 2000);\n        },\n\n        start: function() {\n            var self = this;\n\n            $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_ctrl-btn\").prop(\"disabled\", true);\n\n            self.items.forEach(function(item) {\n                item.spoken = \"\";\n                item.answered = false;\n                item.correct = false;\n            });\n\n            self.game.pointer = 0;\n\n            $(\"#\" + self.itemdata.uniqueid + \"_container .question\").show();\n            $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_start_btn\").hide();\n            $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_mainmenu\").hide();\n            $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_controls\").show();\n\n            self.nextPrompt();\n\n        },\n\n        nextPrompt: function() {\n\n            var self = this;\n\n            $(\".tgapfill_ctrl-btn\").prop(\"disabled\", false);\n\n            var color;\n\n            var progress = self.items.map(function(item, idx) {\n                color = \"gray\";\n                if (self.items[idx].answered && self.items[idx].correct) {\n                    color = \"green\";\n                } else if (self.items[idx].answered && !self.items[idx].correct) {\n                    color = \"red\";\n                }\n                return \"<i style='color:\" + color + \"' class='fa fa-circle'></i>\";\n            }).join(\" \");\n\n            $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_title\").html(progress);\n\n            self.nextReply();\n        },\n\n        nextReply: function() {\n            var self = this;\n            var code = \"<div class='tgapfill_reply tgapfill_reply_\" + self.game.pointer + \" text-center' style='display:none;'>\";\n\n            code += \"<div class='form-container'>\";\n            self.items[self.game.pointer].parsedstring.forEach(function(data, index) {\n                if (data.type === 'input') {\n                    code += \"<input class='single-character' autocomplete='off' type='text' name='filltext\" + index + \"' maxlength='1' data-index='\" + index + \"'>\";\n                } else if (data.type === 'mtext') {\n                    code += \"<input class='single-character-mtext' type='text' name='readonly\" + index + \"' maxlength='1' value='\" + data.character + \"' readonly>\";\n                } else {\n                    code += data.character;\n                }\n            });\n            code += \" <i data-idx='\" + self.game.pointer + \"' class='tgapfill_feedback'></i></div>\";\n\n            code += \"<div class='definition-container'>\";\n            code += \"<div class='definition'>\" + self.items[self.game.pointer].definition + \"</div>\";\n            code += \"</div>\";\n\n            code += \"</div>\";\n            $(\"#\" + self.itemdata.uniqueid + \"_container .question\").append(code);\n\n            var newreply = $(\".tgapfill_reply_\" + self.game.pointer);\n\n            anim.do_animate(newreply, 'zoomIn animate__faster', 'in').then(\n                function() {\n                }\n            );\n\n            $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_ctrl-btn\").prop(\"disabled\", false);\n\n            var inputElements = [...document.querySelectorAll(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_reply_\" + self.game.pointer + ' input.single-character')];\n            self.formReady(inputElements);\n\n            $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_reply_\" + self.game.pointer + ' input.single-character:first').focus();\n\n            if (self.itemdata.timelimit > 0) {\n                $(\"#\" + self.itemdata.uniqueid + \"_container .progress-container\").show();\n                $(\"#\" + self.itemdata.uniqueid + \"_container .progress-container i\").show();\n                var progresbar = $(\"#\" + self.itemdata.uniqueid + \"_container .progress-container #progresstimer\").progressTimer({\n                    height: '5px',\n                    timeLimit: self.itemdata.timelimit,\n                    onFinish: function() {\n                        log.debug('timer finished');\n                        var btn = $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_check_btn\");\n                        log.debug(btn);\n\n                        $(\"#\" + self.itemdata.uniqueid + \"_container .tgapfill_check_btn\").trigger('click');\n                    }\n                });\n\n                progresbar.each(function() {\n                    self.items[self.game.pointer].timer.push($(this).attr('timer'));\n                });\n            }\n        },\n\n        stopTimer: function(timers) {\n            if (timers.length) {\n                timers.forEach(function(timer) {\n                    clearInterval(timer);\n                });\n            }\n        },\n\n        formReady: function(inputElements) {\n            inputElements.forEach(function(ele, index) {\n                ele.addEventListener(\"keydown\", function(e) {\n                    // If the keycode is backspace & the current field is empty\n                    // focus the input before the current. Then the event happens\n                    // which will clear the \"before\" input box.\n                    if (e.keyCode === 8 && e.target.value === \"\") {\n                     inputElements[Math.max(0, index - 1)].focus();\n                    }\n                });\n                ele.addEventListener(\"input\", function(e) {\n                    // Take the first character of the input\n                    // this actually breaks if you input an emoji like üë®‚Äçüë©‚Äçüëß‚Äçüë¶....\n                    // but I'm willing to overlook insane security code practices.\n                    const [first, ...rest] = e.target.value;\n                    e.target.value = first ?? \"\"; // First will be undefined when backspace was entered, so set the input to \"\"\n                    const lastInputBox = index === inputElements.length - 1;\n                    const didInsertContent = first !== undefined;\n                    if (didInsertContent && !lastInputBox) {\n                        // Continue to input the rest of the string\n                        inputElements[index + 1].focus();\n                        inputElements[index + 1].value = rest.join(\"\");\n                        inputElements[index + 1].dispatchEvent(new Event(\"input\"));\n                    }\n                });\n            });\n        },\n    };\n});"],"file":"typinggapfill.min.js"}