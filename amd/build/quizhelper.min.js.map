{"version":3,"file":"quizhelper.min.js","sources":["../src/quizhelper.js"],"sourcesContent":["define(['jquery', 'core/log', 'qtype_minispeak/definitions', 'core/templates', 'core/ajax',\n    'qtype_minispeak/dictation', 'qtype_minispeak/dictationchat', 'qtype_minispeak/multichoice','qtype_minispeak/multiaudio',\n        'qtype_minispeak/speechcards', 'qtype_minispeak/listenrepeat',\n        'qtype_minispeak/page','qtype_minispeak/smartframe','qtype_minispeak/shortanswer',\n        'qtype_minispeak/listeninggapfill','qtype_minispeak/typinggapfill','qtype_minispeak/speakinggapfill'],\n  function($, log, def, templates, Ajax, dictation, dictationchat, multichoice, multiaudio,\n           speechcards, listenrepeat, page, smartframe, shortanswer,\n           listeninggapfill,typinggapfill, speakinggapfill) {\n    \"use strict\"; // jshint ;_;\n\n    /*\n    This file is to manage the quiz stage\n     */\n\n    log.debug('minispeak Quiz helper: initialising');\n\n    return {\n\n      //original spliton_regexp: new RegExp(/([,.!?:;\" ])/, 'g'),\n      spliton_regexp: new RegExp(/([!\"# ¡¿$%&'()。「」、*+,-.\\/:;<=>?@[\\]^_`{|}~])/, 'g'),\n      //nopunc is diff to split on because it does not match on spaces\n      nopunc_regexp: new RegExp(/[!\"#¡¿$%&'()。「」、*+,-.\\/:;<=>?@[\\]^_`{|}~]/,'g'),\n      nonspaces_regexp: new RegExp(/[^ ]/,'g'),\n      autoplaydelay: 800,\n\n      controls: {},\n      submitbuttonclass: 'qtype_minispeak_quizsubmitbutton',\n      stepresults: [],\n      payloadJson: {},\n\n      init: function(quizcontainer, activitydata, cmid, attemptid,polly) {\n        this.quizdata = activitydata.quizdata;\n        this.region = activitydata.region;\n        this.ttslanguage = activitydata.ttslanguage;\n        this.controls.quizcontainer = quizcontainer;\n        this.attemptid = attemptid;\n        this.courseurl = activitydata.courseurl;\n        this.cmid = cmid;\n        this.reattempturl = activitydata.reattempturl;\n        this.activityurl = activitydata.activityurl;\n        this.backtocourse = activitydata.backtocourse;\n        this.stt_guided = activitydata.stt_guided;\n        this.wwwroot = activitydata.wwwroot;\n        this.useanimatecss  = activitydata.useanimatecss;\n        this.questioninstances = [];\n        this.controls.payloadfield = $('#' + this.quizdata[0].payloadfield);\n        this.controls.payloadfield.attr('data-qubaid', this.quizdata[0].qubaid);\n        this.controls.sequencecheck = $('input[name=\"' + this.controls.payloadfield.attr('name').replace('payload', ':sequencecheck') + '\"]');\n        this.controls.status = {\n          hassubitems: this.quizdata[0].hassubitems,\n          card: $(`#${this.quizdata[0].uniqueid}_statuscard`),\n          find: function(name, selector, parent = null) {\n            if (parent && this.hasOwnProperty(parent)) {\n              this[name] = this[parent].find(selector);\n            } else {\n              this[name] = this.card.find(selector);\n            }\n            return this;\n          },\n          op: function(identifiers, callback) {\n            var dd = this;\n            var identifiers = identifiers.split(',');\n            identifiers.forEach(function(identifier) {\n              if (dd.hasOwnProperty(identifier)) {\n                callback(dd[identifier]);\n              }\n            });\n            return dd;\n          },\n          show: function(identifiers) {\n            return this.op(identifiers, function(instance) {\n              instance.attr('data-display', 'show');\n            });\n          },\n          hide: function(identifiers) {\n            return this.op(identifiers, function(instance) {\n              instance.attr('data-display', 'hide');\n            });\n          },\n          hideAll: function() {\n            return this.hide('card,nonattempt,result,summary');\n          },\n          text: function(identifier, text) {\n            if (this.hasOwnProperty(identifier)) {\n              this[identifier].text(text);\n            }\n            return this;\n          },\n          get: function(identifier) {\n            if (this.hasOwnProperty(identifier)) {\n              return this[identifier];\n            }\n          }\n        };\n        this.controls.status.find('result', '.qtype_minispeak_statustext');\n        this.controls.status.find('summary', '[data-region=\"summary\"]', 'result');\n        this.controls.status.find('completed', '[data-region=\"completedcount\"]', 'summary');\n        this.controls.status.find('total', '[data-region=\"totalcount\"]', 'summary');\n        this.controls.status.find('nonattempt', '.qtype_minispeak_statustext_nonattempt');\n        this.controls.status.find('retrybutton', '.qtype_minispeak_retrybutton');\n\n        this.prepare_html();\n        this.init_questions(this.quizdata,polly);\n        this.register_events();\n        this.start_quiz();\n      },\n\n      prepare_html: function() {\n\n        // this.controls.quizcontainer.append(submitbutton);\n        this.controls.quizfinished=$(\"#qtype_minispeak_quiz_finished\");\n        this.updateSummaryCard();\n\n      },\n\n      updateSummaryCard: function() {\n        var payload = this.controls.payloadfield.val();\n        if (payload && payload.trim() !== '') {\n          var payloadArr = payload.split('.');\n          try {\n            var payloadEncData = atob(payloadArr[1]);\n            payloadEncData = payloadEncData.replace(/\"/g,'').replace(/'/g,'');\n            payloadEncData = atob(payloadEncData);\n            this.payloadJson = JSON.parse(payloadEncData);\n            log.debug(this.payloadJson);\n            if (this.payloadJson.hasgrade) {\n              this.controls.status.show('card,result');\n              if (this.controls.status.hassubitems) {\n                this.controls.status\n                  .text('completed', this.payloadJson.correctitems)\n                  .text('total', this.payloadJson.totalitems)\n                  .show('summary');\n              }\n            } else if (this.quizdata[0].locked) {\n              this.controls.status.show('card,nonattempt');\n            } else {\n              this.controls.status.hideAll();\n            }\n          } catch (e) {\n            log.debug(e);\n          }\n        } else if (this.quizdata[0].locked) {\n            this.controls.status.show('card,nonattempt');\n        } else {\n            this.controls.status.hideAll();\n        }\n      },\n\n      init_questions: function(quizdata, polly) {\n        var dd = this;\n        $.each(quizdata, function(index, item) {\n          var questioninstance;\n          switch (item.type) {\n            case def.qtype_dictation:\n              questioninstance = dictation.clone();\n              break;\n            case def.qtype_dictationchat:\n              questioninstance = dictationchat.clone();\n              break;\n            case def.qtype_multichoice:\n              questioninstance = multichoice.clone();\n              break;\n            case def.qtype_multiaudio:\n                questioninstance = multiaudio.clone();\n                break;\n            case def.qtype_speechcards:\n              //speechcards init needs to occur when it is visible. lame.\n              // so we do that in do_next function, down below\n              questioninstance = speechcards.clone();\n              break;\n            case def.qtype_listenrepeat:\n              questioninstance = listenrepeat.clone();\n              break;\n\n             case def.qtype_page:\n                  questioninstance = page.clone();\n                  break;\n\n              case def.qtype_smartframe:\n                  questioninstance = smartframe.clone();\n                  break;\n\n              case def.qtype_shortanswer:\n                  questioninstance = shortanswer.clone();\n                  break;\n\n              case def.qtype_listeninggapfill:\n                  questioninstance = listeninggapfill.clone();\n                  break;\n\n              case def.qtype_typinggapfill:\n                  questioninstance = typinggapfill.clone();\n                  break;\n\n              case def.qtype_speakinggapfill:\n                  questioninstance = speakinggapfill.clone();\n                  break;\n          }\n\n          if (questioninstance) {\n            questioninstance.init(index, item, dd, polly);\n            dd.questioninstances.push(questioninstance);\n          }\n\n        });\n\n        //TTS in question headers\n          $(\"audio.qtype_minispeak_itemttsaudio\").each(function(){\n              var that=this;\n              polly.fetch_polly_url($(this).data('text'), $(this).data('ttsoption'), $(this).data('voice')).then(function(audiourl) {\n                  $(that).attr(\"src\", audiourl);\n              });\n          });\n\n      },\n\n      register_events: function() {\n        var dd = this;\n        $('.' + this.submitbuttonclass).on('click', function() {\n          //do something\n        });\n        var retrybutton = this.controls.status.get('retrybutton');\n        if (retrybutton) {\n          retrybutton.on('click', function(e) {\n            e.preventDefault();\n            /* dd.questioninstances.forEach(function(questioninstance) {\n              if (typeof questioninstance.start === 'function') {\n                questioninstance.start();\n              }\n            });\n            dd.controls.payloadfield.val('');\n            dd.updateSummaryCard();\n            if (dd.payloadJson?.hasgrade) {\n              dd.payloadJson = {};\n              dd.report_step_grade(dd.payloadJson);\n            } */\n            dd.report_step_grade({}, false, true).then(function(token) {\n              var reloadcallback = function() {\n                location.reload();\n              }\n              if (token) {\n                  try {\n                    require(['core_form/changechecker'], function(changechecker) {\n                      changechecker.resetFormDirtyState(retrybutton.get(0));\n                      reloadcallback();\n                    });\n                  } catch(e) {\n                    log.debug('old moodle found');\n                    if (M.core_formchangechecker !== undefined) {\n                      M.core_formchangechecker.reset_form_dirty_state();\n                    }\n                    reloadcallback();\n                  }\n              }\n            })\n          })\n        }\n      },\n      render_quiz_progress:function(current,total){\n        var array = [];\n        for(var i=0;i<total;i++){\n          array.push(i);\n        }\n\n        if(total<6) {\n            var slice = array.slice(0, 5);\n            var linestyles = \"width: \" + (100 - 100 / slice.length) + \"%; margin-left: auto; margin-right: auto\";\n            var html = \"<div class='minispeak_quiz_progress_line' style='\" + linestyles + \"'></div>\";\n\n            slice.forEach(function (i) {\n                html += \"<div class='minispeak_quiz_progress_item \" + (i === current ? 'minispeak_quiz_progress_item_current' : '') + \" \" + (i < current ? 'minispeak_quiz_progress_item_completed' : '') + \"'>\" + (i + 1) + \"</div>\";\n            });\n        }else {\n             if(current > total-6){\n                 var slice = array.slice(total-5, total-1);\n             }else{\n                 var slice = array.slice(current, current + 4);\n             }\n\n              //if first item is visible then no line trailing left of item 1\n              if(current==0){\n                  var linestyles = \"width: 80%; margin-left: auto; margin-right: auto\";\n              }else {\n                  var linestyles = \"width: \" + (100 - 100 / (2 *slice.length)) + \"%; margin-left: 0\";\n              }\n            var html = \"<div class='minispeak_quiz_progress_line' style='\" + linestyles + \"'></div>\";\n              slice.forEach(function (i) {\n                  html += \"<div class='minispeak_quiz_progress_item \" + (i === current ? 'minispeak_quiz_progress_item_current' : '') + \" \" + (i < current ? 'minispeak_quiz_progress_item_completed' : '') + \"'>\" + (i + 1) + \"</div>\";\n              });\n              //end marker\n            html += \"<div class='minispeak_quiz_progress_finalitem'>\" + (total) + \"</div>\";\n          }\n\n        html+=\"\";\n        $(\".minispeak_quiz_progress\").html(html);\n\n      },\n\n      do_next: function(stepdata, showSummary){\n        var dd = this;\n        //get current question\n        var currentquizdataindex =   stepdata.index;\n        var currentitem = this.quizdata[currentquizdataindex];\n\n        //in preview mode do no do_next\n        if(currentitem.preview===true){return;}\n\n        //post grade\n         // log.debug(\"reporting step grade\");\n        dd.report_step_grade(stepdata, showSummary);\n\n        //in single mode do no do_next\n        if(currentitem.singlemode===true){return;}\n\n         // log.debug(\"reported step grade\");\n        //hide current question\n        var theoldquestion = $(\"#\" + currentitem.uniqueid + \"_container\");\n        theoldquestion.hide();\n        //show next question or End Screen\n        if (dd.quizdata.length > currentquizdataindex+1) {\n          var nextindex = currentquizdataindex+ 1;\n          var nextitem = this.quizdata[nextindex];\n            //show the question\n            $(\"#\" + nextitem.uniqueid + \"_container\").show();\n          //any per question type init that needs to occur can go here\n          switch (nextitem.type) {\n              case def.qtype_speechcards:\n                  //speechcards.init(nextindex, nextitem, dd);\n                  break;\n              case def.qtype_dictation:\n              case def.qtype_dictationchat:\n              case def.qtype_multichoice:\n              case def.qtype_multiaudio:\n              case def.qtype_listenrepeat:\n              case def.qtype_smartframe:\n              case def.qtype_shortanswer:\n              default:\n          }//end of nextitem switch\n\n            //autoplay audio if we need to\n            var ttsquestionplayer = $(\"#\" + nextitem.uniqueid + \"_container audio.qtype_minispeak_itemttsaudio\");\n            if(ttsquestionplayer.data('autoplay')==\"1\"){\n                var that=this;\n                setTimeout(function() {ttsquestionplayer[0].play();}, that.autoplaydelay);\n            }\n\n        } else {\n          //just reload and re-fetch all the data to display\n            $(\".minispeak_nextbutton\").prop(\"disabled\", true);\n            setTimeout(function () {\n               // log.debug(\"forwarding to finished page\");\n                window.location.href=dd.activityurl;\n            }, 1000);\n\n          return;\n\n          //no longer do this\n            /*\n          var results = dd.stepresults.filter(function(e){return e.hasgrade;});\n          var correctitems = 0;\n          var totalitems = 0;\n          results.forEach(function(result,i){\n            result.index=i+1;\n            result.title=dd.quizdata[i].title;\n            correctitems += result.correctitems;\n            totalitems += result.totalitems;\n          });\n          var totalpercent = Math.round((correctitems/totalitems)*100);\n          console.log(results,correctitems,totalitems,totalpercent);\n          var finishedparams ={results:results,total:totalpercent, courseurl: this.courseurl};\n          if(this.reattempturl!=''){finishedparams.reattempturl = this.reattempturl;}\n          if(this.backtocourse!=''){finishedparams.backtocourse = true;}\n          templates.render('qtype_minispeak/quizfinished',finishedparams).then(\n              function(html,js){\n                  dd.controls.quizfinished.html(html);\n                  dd.controls.quizfinished.show();\n                  templates.runTemplateJS(js);\n              }\n          );\n          */\n\n        }//end of if has more questions\n\n        this.render_quiz_progress(stepdata.index+1,this.quizdata.length);\n\n          //we want to destroy the old question in the DOM also because iframe/media content might be playing\n          theoldquestion.remove();\n\n      },\n\n      report_step_grade: function(stepdata, showSummary, store = true) {\n        var dd = this;\n\n        //store results locally\n        this.stepresults.push(stepdata);\n\n        log.debug(stepdata);\n\n        //push results to server\n        var ret = Ajax.call([{\n          methodname: 'qtype_minispeak_report_step_grade',\n          args: {\n            cmid: dd.cmid,\n            qubaid: dd.quizdata[0].qubaid,\n            step: btoa(JSON.stringify(stepdata)),\n            store: Boolean(store)\n          },\n          async: false\n        }])[0].then(function(response) {\n          if (response.newsequence) {\n            dd.controls.sequencecheck.val(response.newsequence);\n          }\n          if (response.token) {\n            dd.controls.payloadfield.val(response.token);\n            if (showSummary) {\n              dd.updateSummaryCard();\n            }\n            return response.token;\n          }\n        });\n        log.debug(\"report_step_grade success: \" + ret);\n        return ret;\n      },\n\n\n\n      start_quiz: function() {\n        $(\"#\" + this.quizdata[0].uniqueid + \"_container\").show();\n          //autoplay audio if we need to\n          var ttsquestionplayer = $(\"#\" + this.quizdata[0].uniqueid + \"_container audio.qtype_minispeak_itemttsaudio\");\n          if(ttsquestionplayer.data('autoplay')==\"1\"){\n              var that=this;\n              setTimeout(function() {ttsquestionplayer[0].play();}, that.autoplaydelay);\n          }\n        this.render_quiz_progress(0,this.quizdata.length);\n      },\n\n      //this function is overridden by the calling class\n      onSubmit: function() {\n        alert('quiz submitted. Override this');\n      },\n\n        mobile_user: function() {\n\n            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {\n                return true;\n            } else {\n                return false;\n            }\n        },\n\n        chrome_user: function(){\n            if(/Chrome/i.test(navigator.userAgent)) {\n                return true;\n            }else{\n                return false;\n            }\n        },\n\n        //this will always be true these days\n        use_ttrecorder: function(){\n            return true;\n        },\n        is_stt_guided: function(){\n          return this.stt_guided;\n        },\n\n        //text comparison functions follow===============\n\n        similarity: function(s1, s2) {\n            //we remove spaces because JP transcript and passage might be different. And who cares about spaces anyway?\n            s1 = s1.replace(/\\s+/g, '');\n            s2 = s2.replace(/\\s+/g, '');\n\n            var longer = s1;\n            var shorter = s2;\n            if (s1.length < s2.length) {\n                longer = s2;\n                shorter = s1;\n            }\n            var longerLength = longer.length;\n            if (longerLength === 0) {\n                return 100;\n            }\n            return 100 * ((longerLength - this.editDistance(longer, shorter)) / parseFloat(longerLength));\n        },\n        editDistance: function(s1, s2) {\n            s1 = s1.toLowerCase();\n            s2 = s2.toLowerCase();\n\n            var costs = [];\n            for (var i = 0; i <= s1.length; i++) {\n                var lastValue = i;\n                for (var j = 0; j <= s2.length; j++) {\n                    if (i === 0)\n                        costs[j] = j;\n                    else {\n                        if (j > 0) {\n                            var newValue = costs[j - 1];\n                            if (s1.charAt(i - 1) !== s2.charAt(j - 1))\n                                newValue = Math.min(Math.min(newValue, lastValue),\n                                    costs[j]) + 1;\n                            costs[j - 1] = lastValue;\n                            lastValue = newValue;\n                        }\n                    }\n                }\n                if (i > 0)\n                    costs[s2.length] = lastValue;\n            }\n            return costs[s2.length];\n        },\n\n        cleanText: function(text) {\n            var lowertext = text.toLowerCase();\n            var punctuationless = lowertext.replace(this.nopunc_regexp,\"\");\n            var ret = punctuationless.replace(/\\s+/g, \" \").trim();\n            return ret;\n        },\n\n        //this will return the promise, the result of which is an integer 100 being perfect match, 0 being no match\n        checkByPhonetic: function(passage, transcript, passagephonetic, language) {\n            return Ajax.call([{\n                methodname: 'qtype_minispeak_check_by_phonetic',\n                args: {\n                    'spoken': transcript,\n                    'correct': passage,\n                    'language': language,\n                    'phonetic': passagephonetic,\n                    'region': this.region,\n                    'cmid': this.cmid\n                },\n                async: false\n            }])[0];\n\n        },\n\n       comparePassageToTranscript: function (passage,transcript,passagephonetic, language){\n          return Ajax.call([{\n               methodname: 'qtype_minispeak_compare_passage_to_transcript',\n               args: {\n                   passage: passage,\n                   transcript: transcript,\n                   alternatives: '',\n                   phonetic: passagephonetic,\n                   language: language,\n                   region: this.region,\n                   cmid: this.cmid\n               },\n              async: false\n           }])[0];\n       }\n    }; //end of return value\n  });\n"],"names":["define","$","log","def","templates","Ajax","dictation","dictationchat","multichoice","multiaudio","speechcards","listenrepeat","page","smartframe","shortanswer","listeninggapfill","typinggapfill","speakinggapfill","debug","spliton_regexp","RegExp","nopunc_regexp","nonspaces_regexp","autoplaydelay","controls","submitbuttonclass","stepresults","payloadJson","init","quizcontainer","activitydata","cmid","attemptid","polly","quizdata","region","ttslanguage","courseurl","reattempturl","activityurl","backtocourse","stt_guided","wwwroot","useanimatecss","questioninstances","payloadfield","this","attr","qubaid","sequencecheck","replace","status","hassubitems","card","uniqueid","find","name","selector","parent","hasOwnProperty","op","identifiers","callback","dd","split","forEach","identifier","show","instance","hide","hideAll","text","get","prepare_html","init_questions","register_events","start_quiz","quizfinished","updateSummaryCard","payload","val","trim","payloadArr","payloadEncData","atob","JSON","parse","hasgrade","correctitems","totalitems","locked","e","each","index","item","questioninstance","type","qtype_dictation","clone","qtype_dictationchat","qtype_multichoice","qtype_multiaudio","qtype_speechcards","qtype_listenrepeat","qtype_page","qtype_smartframe","qtype_shortanswer","qtype_listeninggapfill","qtype_typinggapfill","qtype_speakinggapfill","push","that","fetch_polly_url","data","then","audiourl","on","retrybutton","preventDefault","report_step_grade","token","reloadcallback","location","reload","require","changechecker","resetFormDirtyState","undefined","M","core_formchangechecker","reset_form_dirty_state","render_quiz_progress","current","total","array","i","html","linestyles","slice","length","do_next","stepdata","showSummary","currentquizdataindex","currentitem","preview","singlemode","theoldquestion","prop","setTimeout","window","href","nextindex","nextitem","ttsquestionplayer","play","remove","store","ret","call","methodname","args","step","btoa","stringify","Boolean","async","response","newsequence","onSubmit","alert","mobile_user","test","navigator","userAgent","chrome_user","use_ttrecorder","is_stt_guided","similarity","s1","s2","longer","shorter","longerLength","editDistance","parseFloat","toLowerCase","costs","lastValue","j","newValue","charAt","Math","min","cleanText","checkByPhonetic","passage","transcript","passagephonetic","language","comparePassageToTranscript","alternatives","phonetic"],"mappings":"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"}