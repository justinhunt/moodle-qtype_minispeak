{"version":3,"sources":["../src/shortanswer.js"],"names":["define","$","log","def","polly","cloudpoodll","ttrecorder","anim","debug","answers","passmark","clone","extend","init","index","itemdata","quizhelper","animopts","useanimatecss","register_events","init_components","next_question","percent","self","stepdata","hasgrade","totalitems","correctitems","grade","do_next","prepare_audio","each","sentences","sentence","fetch_polly_url","voiceoption","usevoice","then","audiourl","uniqueid","attr","on","prop","html","correctanswer","checked","data","setTimeout","app","i","length","originalsentence","cleanText","theCallback","message","type","speechtext","capturedspeech","cleanspeechtext","spoken","matched","x","similar","similarity","spokenIsCorrect","process_accepted_response","checkByPhonetic","phonetic","language","comparePassageToTranscript","ajaxresult","result","JSON","parse","haserror","answer","correct","theanswer","do_animate","opts","callback","stt_guided","is_stt_guided","phraseheard","currentphrase","sentenceindex","parseInt","show_text","text","answerdisplay","addClass"],"mappings":"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","sourcesContent":["define(['jquery',\n      'core/log',\n      'qtype_minispeak/definitions',\n      'qtype_minispeak/pollyhelper',\n      'qtype_minispeak/cloudpoodllloader',\n      'qtype_minispeak/ttrecorder',\n      'qtype_minispeak/animatecss'],\n    function($, log, def, polly,cloudpoodll, ttrecorder, anim) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the quiz stage\n   */\n\n  log.debug('minispeak ShortAnswer: initialising');\n\n  return {\n\n    answers: {},\n\n    passmark: 90,//lower this if it often doesnt match (was 85)\n\n    //for making multiple instances\n      clone: function () {\n          return $.extend(true, {}, this);\n     },\n\n    init: function(index, itemdata, quizhelper) {\n\n      //anim\n      var animopts = {};\n      animopts.useanimatecss=quizhelper.useanimatecss;\n      anim.init(animopts);\n\n      this.register_events(index, itemdata, quizhelper);\n      this.init_components(index, itemdata, quizhelper);\n    },\n    next_question: function(percent) {\n      var self = this;\n      var stepdata = {};\n      stepdata.index = self.index;\n      stepdata.hasgrade = true;\n      stepdata.totalitems = 1;\n      stepdata.correctitems = percent>0?1:0;\n      stepdata.grade = percent;\n      stepdata.answers = self.answers;\n      self.quizhelper.do_next(stepdata, true);\n    },\n\n    /* NOT NEEDED */\n    prepare_audio: function(itemdata) {\n      // debugger;\n      $.each(itemdata.sentences, function(index, sentence) {\n        polly.fetch_polly_url(sentence.sentence, itemdata.voiceoption, itemdata.usevoice).then(function(audiourl) {\n          $(\"#\" + itemdata.uniqueid + \"_option\" + (index+1)).attr(\"data-src\", audiourl);\n        });\n      });\n    },\n\n    register_events: function(index, itemdata, quizhelper) {\n\n      var self = this;\n      self.index = index;\n      self.quizhelper = quizhelper;\n\n      $(\"#\" + itemdata.uniqueid + \"_container .minispeak_nextbutton\").on('click', function(e) {\n        self.next_question(0);\n      });\n\n      $(\"#\" + itemdata.uniqueid + \"_container .\" + itemdata.uniqueid + \"_option\").on('click', function(e) {\n\n        $(\".\" + itemdata.uniqueid + \"_option\").prop(\"disabled\", true);\n        $(\".\" + itemdata.uniqueid + \"_fb\").html(\"<i style='color:red;' class='fa fa-times'></i>\");\n        $(\".\" + itemdata.uniqueid + \"_option\" + itemdata.correctanswer + \"_fb\").html(\"<i style='color:green;' class='fa fa-check'></i>\");\n\n        var checked = $('input[name='+itemdata.uniqueid+'_options]:checked').data('index');\n        var percent = checked == itemdata.correctanswer ? 100 : 0;\n\n        $(\".minispeak_nextbutton\").prop(\"disabled\", true);\n        setTimeout(function() {\n          $(\".minispeak_nextbutton\").prop(\"disabled\", false);\n          self.next_question(percent);\n        }, 2000);\n\n      });\n\n    },\n\n    init_components: function(index, itemdata, quizhelper) {\n      var app= this;\n      var sentences = itemdata.sentences;//sentence & phonetic\n\n      log.debug('initcomponents_shortanswer');\n      log.debug(sentences);\n\n      //clean the text of any junk\n      for(var i=0;i<sentences.length;i++){\n          sentences[i].originalsentence= sentences[i].sentence\n          sentences[i].sentence=quizhelper.cleanText(sentences[i].sentence);\n      }\n\n      var theCallback = async function(message) {\n\n        switch (message.type) {\n          case 'recording':\n\n            break;\n\n          case 'speech':\n            log.debug(\"speech at shortanswer\");\n            var speechtext = message.capturedspeech;\n            var cleanspeechtext = quizhelper.cleanText(speechtext);\n            var spoken = cleanspeechtext;\n\n            log.debug('speechtext:',speechtext);\n            log.debug('cleanspeechtext:',spoken);\n            var matched=false;\n            var percent=0;\n\n            //Similarity check by direct-match/acceptable-mistranscriptio\n            for(var x=0;x<sentences.length;x++){\n              //if this is the correct answer index, just move on\n              if(sentences[x].sentence===''){continue;}\n              var similar = quizhelper.similarity(spoken, sentences[x].sentence);\n              log.debug('JS similarity: ' + spoken + ':' + sentences[x].sentence + ':' + similar);\n              if (similar >= app.passmark ||\n                  app.spokenIsCorrect(quizhelper, cleanspeechtext, sentences[x].sentence)) {\n                  percent = app.process_accepted_response(itemdata, x);\n                  matched=true;\n                  break;\n              }//end of if similarity\n            }//end of for x\n\n            //Similarity check by phonetics(ajax)\n            //this is an expensive call since it goes out to the server and possibly to the cloud\n            if(!matched) {\n              for (x = 0; x < sentences.length; x++) {\n                var similarity = await quizhelper.checkByPhonetic(sentences[x].sentence, spoken, sentences[x].phonetic, itemdata.language);\n                log.debug(similarity, 'PHP similarity');\n                if (!similarity || similarity < app.passmark) {\n                  //keep looking\n                } else {\n                  matched = true;\n                  log.debug('PHP similarity: ' + spoken + similarity);\n                  percent = app.process_accepted_response(itemdata, x);\n                  break;\n                }\n              }//end of Similarity check by phonetics(ajax) loop\n            }\n\n            //we do not do a passage match check , but this is how we would ..\n              if(!matched ) {\n                for (x = 0; x < sentences.length; x++) {\n                  var ajaxresult = await quizhelper.comparePassageToTranscript(sentences[x].sentence, spoken, sentences[x].phonetic, itemdata.language);\n                  var result = JSON.parse(ajaxresult);\n                  var haserror=false;\n                  for (var i=0;i<result.length;i++){\n                    if(result[i].matched===false){haserror=true;break;}\n                  }\n                  if(!haserror){\n                    percent = app.process_accepted_response(itemdata, x);\n                    matched=true;\n                    break;\n                  }\n                }\n              }\n\n            app.answers[0] = {\n              answer: spoken,\n              correct: Boolean(matched)\n            };\n\n              //if we got a match then process it\n            if(matched){\n              //proceed to next question\n              $(\".minispeak_nextbutton\").prop(\"disabled\", true);\n              setTimeout(function () {\n                $(\".minispeak_nextbutton\").prop(\"disabled\", false);\n                app.next_question(percent);\n              }, 2000);\n              return;\n            }else{\n              //shake the screen\n              var theanswer = $(\"#\" + itemdata.uniqueid + \"_correctanswer\");\n              anim.do_animate(theanswer,'rubberBand animate__faster').then(\n                  function() {}\n              );\n              //$(\"#\" + itemdata.uniqueid + \"_correctanswer\").effect(\"shake\");\n            }\n        } //end of switch message type\n      }; //end of callback declaration\n\n      //init TT recorder\n      var opts = {};\n      opts.uniqueid = itemdata.uniqueid;\n      log.debug('sa uniqueid:' + itemdata.uniqueid);\n      opts.callback = theCallback;\n      opts.stt_guided=quizhelper.is_stt_guided();\n      ttrecorder.clone().init(opts);\n\n    } ,//end of init components\n\n    spokenIsCorrect: function(quizhelper, phraseheard, currentphrase) {\n      //lets lower case everything\n      phraseheard = quizhelper.cleanText(phraseheard);\n      currentphrase = quizhelper.cleanText(currentphrase);\n      if (phraseheard === currentphrase) {\n        return true;\n      }\n      return false;\n    },\n\n    process_accepted_response: function(itemdata, sentenceindex){\n      var percent = sentenceindex >= 0 ? 100 : 0;\n      //TO DO .. disable TT recorder here\n      //disable TT recorder\n\n      if(percent > 0) {\n        //turn dots into text (if they were dots)\n        if (parseInt(itemdata.show_text) === 0) {\n          for (var i = 0; i < itemdata.sentences.length; i++) {\n            var theline = $(\"#\" + itemdata.uniqueid + \"_option\" + (i + 1));\n            $(\"#\" + itemdata.uniqueid + \"_option\" + (i + 1) + ' .minispeak_sentence').text(itemdata.sentences[i].sentence);\n          }\n        }\n\n        //hightlight successgit cm\n        var  answerdisplay =  $(\"#\" + itemdata.uniqueid + \"_correctanswer\");\n        answerdisplay.text(itemdata.sentences[sentenceindex].originalsentence);\n        answerdisplay.addClass(\"minispeak_success\");\n      }\n\n      return percent;\n\n    },\n\n  };\n});"],"file":"shortanswer.min.js"}